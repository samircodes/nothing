import pandas as pd
import xlwings as xw

# Sample data
data = {
    'Business Unit': ['BU1', 'BU1', 'BU2', 'BU2'],
    'Scenario': ['Actual', 'Forecast', 'Actual', 'Forecast'],
    'Period': ['Q1', 'Q2', 'Q1', 'Q2'],
    'Profit': [100, 150, 200, 250],
    'Loss': [20, 30, 40, 50]
}
df = pd.DataFrame(data)

# Define save path
save_path = r'C:\Users\YourUsername\Documents\real_pivot.xlsx'

# Create a new workbook
wb = xw.Book()
sheet_data = wb.sheets[0]
sheet_data.name = "Data"
sheet_data.range("A1").value = df

# Define the range of the source data
last_row = len(df) + 1  # +1 for header
last_col = len(df.columns)
source_range = sheet_data.range((1,1), (last_row, last_col))

# Create Pivot Table sheet
sheet_pivot = wb.sheets.add("Pivot")

# Create Pivot Cache
pivot_cache = wb.api.PivotTableWizard(
    SourceType=1,
    SourceData=source_range.api,
    TableDestination=sheet_pivot.range("A3").api,
    TableName="MyPivotTable"
)

# Add fields to pivot
pivot_table = sheet_pivot.api.PivotTables("MyPivotTable")
pivot_table.PivotFields("Business Unit").Orientation = 3  # xlPageField (Filter)
pivot_table.PivotFields("Scenario").Orientation = 3       # xlPageField (Filter)
pivot_table.PivotFields("Period").Orientation = 2         # xlColumnField
pivot_table.PivotFields("Profit").Orientation = 4         # xlDataField
pivot_table.PivotFields("Loss").Orientation = 4           # xlDataField

# Save and optionally close
wb.save(save_path)
# wb.close()
