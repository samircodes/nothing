Dim isHidden As Boolean ' Track whether columns are currently hidden

Sub ToggleZeroSumColumns()
    Dim pt As PivotTable
    Dim pf As PivotField
    Dim ws As Worksheet
    Dim lastCol As Long
    Dim i As Long
    Dim colSum As Double
    Dim btn As Button
    
    Set ws = ThisWorkbook.Sheets("BU_pivot")
    Set pt = ws.PivotTables("PivotTable2") ' Use the name of your pivot table
    Set btn = ws.Buttons("Button1")
    
    ' Get the last column in the PivotTable's data range
    lastCol = pt.DataBodyRange.Columns.Count
    
    ' Toggle between hiding and unhiding
    If isHidden Then
        ' Unhide all columns
        For i = 1 To lastCol
            ws.Columns(pt.DataBodyRange.Cells(1, i).Column).EntireColumn.Hidden = False
        Next i
        btn.Caption = "Click to hide"
        isHidden = False
    Else
        ' Hide columns where the sum is zero
        For i = 1 To lastCol
            colSum = Application.WorksheetFunction.Sum(pt.DataBodyRange.Columns(i))
            If colSum = 0 Then
                ws.Columns(pt.DataBodyRange.Cells(1, i).Column).EntireColumn.Hidden = True
            End If
        Next i
        btn.Caption = "Click to unhide"
        isHidden = True
    End If
End Sub

Sub Worksheet_PivotTableUpdate(ByVal Target As PivotTable)
    ' Keep the button state when the filter is changed
    If isHidden Then
        ' Re-hide zero-sum columns after filter changes
        ToggleZeroSumColumns
    End If
End Sub
